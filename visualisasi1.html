<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualisasi 3D Ikatan Tunggal - Alkana</title>
    <link rel="icon" href="favicon.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #020617; font-family: 'Segoe UI', sans-serif; touch-action: none; }
        #ui-layer { 
            position: absolute; top: 0; left: 0; padding: 1rem; 
            pointer-events: none; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: space-between;
            color: white; z-index: 10; 
        }
        .interactive { pointer-events: auto; }
        canvas { display: block; width: 100vw; height: 100vh; }
        .glass { 
            /* Ganti background jadi Ungu Muda Transparan */
            background: rgba(168, 85, 247, 0.25); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(233, 213, 255, 0.2); 
            box-shadow: 0 8px 32px 0 rgba(88, 28, 135, 0.37);
        }
        .info-scroll::-webkit-scrollbar { width: 3px; }
        /* Scrollbar ungu */
        .info-scroll::-webkit-scrollbar-thumb { background: rgba(192, 132, 252, 0.5); border-radius: 10px; }
        /* Glow ungu */
        .glow-text { text-shadow: 0 0 10px rgba(168, 85, 247, 0.8); }
        
        /* Accordion Styling */
        summary { list-style: none; cursor: pointer; }
        summary::-webkit-details-marker { display: none; }
        details[open] summary .chevron { transform: rotate(180deg); }
        .chevron { transition: transform 0.3s ease; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <!-- Control Panel Utama -->
        <div class="max-w-full md:max-w-sm interactive">
            <div class="glass p-4 rounded-3xl space-y-4">
                <header>
                    <!-- Ubah text-blue jadi text-purple -->
                    <h1 class="text-xl font-black text-purple-300 glow-text">ETANA 3D</h1>
                    <p class="text-[9px] text-purple-200/70 tracking-widest uppercase">Visualisasi Alkana (Câ‚‚Hâ‚†)</p>
                </header>
                
                <div class="space-y-3">
                    <!-- Mode Toggle -->
                    <div class="bg-black/20 p-2 rounded-xl border border-white/5">
                        <div class="flex gap-2">
                            <!-- Ubah bg-blue jadi bg-purple -->
                            <button id="viewOrbital" class="flex-1 py-1.5 rounded-lg text-[10px] font-bold bg-purple-600 text-white transition-all shadow-lg shadow-purple-900/20">ORBITAL</button>
                            <button id="viewStick" class="flex-1 py-1.5 rounded-lg text-[10px] font-bold bg-slate-700 text-slate-300 hover:bg-slate-600 transition-all">STRUKTUR</button>
                        </div>
                    </div>

                    <!-- Accordion: Kontrol Ikatan -->
                    <details class="group">
                        <summary class="flex items-center justify-between p-2 bg-white/5 rounded-xl hover:bg-white/10 transition-colors">
                            <span class="text-xs font-bold text-purple-200 uppercase tracking-tight">Jenis Ikatan</span>
                            <svg class="chevron w-4 h-4 text-purple-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </summary>
                        <div class="mt-2 space-y-1 px-1">
                            <label class="flex items-center justify-between p-2 hover:bg-white/5 rounded-lg cursor-pointer">
                                <div class="flex items-center gap-3">
                                    <span class="w-2 h-2 rounded-full bg-yellow-400 shadow-[0_0_8px_#facc15]"></span>
                                    <span class="text-[11px] font-medium text-yellow-100">Ikatan Sigma (Ïƒ)</span>
                                </div>
                                <input type="checkbox" id="toggleSigma" checked class="w-3 h-3 accent-yellow-400 cursor-pointer">
                            </label>
                            <div class="p-2 text-[10px] text-gray-400 italic">
                                *Hanya terdapat ikatan tunggal pada Alkana
                            </div>
                        </div>
                    </details>
                </div>
            </div>
        </div>

        <!-- Accordion: Informasi -->
        <div class="max-w-full md:max-w-sm interactive">
            <details class="glass rounded-3xl overflow-hidden group">
                <!-- Ubah border-blue jadi border-purple -->
                <summary class="flex items-center justify-between p-4 border-l-4 border-purple-400 bg-white/5 hover:bg-white/10 transition-colors">
                    <h2 class="text-[11px] font-bold text-purple-200 uppercase tracking-tight">Kenapa bentuknya Tetrahedral?</h2>
                    <svg class="chevron w-4 h-4 text-purple-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </summary>
                <div class="p-4 pt-0 info-scroll max-h-56 overflow-y-auto">
                    <ul class="text-[11px] space-y-3 text-gray-200 mt-3">
                        <li class="flex gap-2">
                            <span>ðŸ’¡</span>
                            <span><b>Hibridisasi spÂ³:</b> Setiap atom Karbon mengikat 4 atom lain (1 C + 3 H), membentuk geometri tetrahedral dengan sudut ~109.5Â°.</span>
                        </li>
                        <li class="flex gap-2">
                            <span>ðŸ”„</span>
                            <span><b>Rotasi Bebas:</b> Tidak seperti ikatan rangkap (C=C atau Câ‰¡C) yang kaku, ikatan tunggal C-C memungkinkan atom berputar bebas pada porosnya.</span>
                        </li>
                        <li class="flex gap-2">
                            <span>ðŸ§©</span>
                            <span><b>Konformasi:</b> Model ini menunjukkan konformasi "Staggered" (berselang-seling) yang paling stabil karena meminimalkan tolakan antar elektron hidrogen.</span>
                        </li>
                    </ul>
                </div>
            </details>
        </div>
    </div>

    <script>
        let scene, camera, renderer, controls;
        let sigmaBonds = [], stickModel = [];
        let currentMode = 'orbital'; 

        function init() {
            if (typeof THREE === 'undefined') return;

            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x020617, 0.05);

            const fov = window.innerWidth < 768 ? 75 : 60;
            camera = new THREE.PerspectiveCamera(fov, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(4, 3, 6);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            document.body.appendChild(renderer.domElement);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 0.5;

            // Lights
            scene.add(new THREE.AmbientLight(0xffffff, 0.4));
            const p1 = new THREE.PointLight(0x60a5fa, 1.5, 20); p1.position.set(5, 5, 5); scene.add(p1);
            const p2 = new THREE.PointLight(0xffffff, 0.8, 20); p2.position.set(-5, 2, -5); scene.add(p2);

            createMolecule();

            window.addEventListener('resize', onWindowResize, false);
            
            // UI Logic
            const btnOrbital = document.getElementById('viewOrbital');
            const btnStick = document.getElementById('viewStick');

            const updateVisibility = () => {
                const sigmaCheck = document.getElementById('toggleSigma').checked;

                if (currentMode === 'orbital') {
                    sigmaBonds.forEach(b => b.visible = sigmaCheck);
                    stickModel.forEach(b => b.visible = false);
                } else {
                    sigmaBonds.forEach(b => b.visible = false);
                    stickModel.forEach(b => b.visible = true);
                }
            };

            btnOrbital.onclick = () => {
                currentMode = 'orbital';
                // Ubah class ke ungu saat aktif
                btnOrbital.className = "flex-1 py-1.5 rounded-lg text-[10px] font-bold bg-purple-600 text-white transition-all shadow-lg";
                btnStick.className = "flex-1 py-1.5 rounded-lg text-[10px] font-bold bg-slate-700 text-slate-300 hover:bg-slate-600 transition-all";
                updateVisibility();
            };

            btnStick.onclick = () => {
                currentMode = 'stick';
                // Ubah class ke ungu saat aktif
                btnStick.className = "flex-1 py-1.5 rounded-lg text-[10px] font-bold bg-purple-600 text-white transition-all shadow-lg";
                btnOrbital.className = "flex-1 py-1.5 rounded-lg text-[10px] font-bold bg-slate-700 text-slate-300 hover:bg-slate-600 transition-all";
                updateVisibility();
            };
            
            // Removing duplicate code block here to fix SyntaxError

            document.getElementById('toggleSigma').onchange = updateVisibility;
            
            animate();
        }

        function createAtomLabel(text, color = "white") {
            const canvas = document.createElement('canvas');
            const size = 256;
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');
            
            ctx.fillStyle = color;
            ctx.font = 'Bold 160px Inter, Segoe UI, sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.shadowColor = 'rgba(0,0,0,0.5)';
            ctx.shadowBlur = 15;
            ctx.fillText(text, size / 2, size / 2);

            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({ map: texture, transparent: true, depthTest: false });
            const sprite = new THREE.Sprite(material);
            sprite.scale.set(0.6, 0.6, 1);
            sprite.renderOrder = 999;
            return sprite;
        }

        function createMolecule() {
            const carbonMat = new THREE.MeshStandardMaterial({ color: 0x111111, roughness: 0.2, metalness: 0.8 });
            const hydrogenMat = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.3 });
            // Sigma material slightly more opaque for solid feel
            const sigmaMat = new THREE.MeshStandardMaterial({ color: 0xfacc15, emissive: 0xfacc15, emissiveIntensity: 0.2, transparent: true, opacity: 0.8 });
            const stickMat = new THREE.MeshStandardMaterial({ color: 0x94a3b8 });

            const cGeo = new THREE.SphereGeometry(0.5, 32, 32);
            const hGeo = new THREE.SphereGeometry(0.25, 32, 32);

            // Koordinat Etana (Staggered conformation)
            // Jarak C-C ~ 1.5
            const cOffset = 0.75;
            
            // --- ATOM KARBON ---
            const c1 = new THREE.Mesh(cGeo, carbonMat); c1.position.x = -cOffset; scene.add(c1);
            const lc1 = createAtomLabel("C", "#60a5fa"); lc1.position.copy(c1.position); scene.add(lc1);

            const c2 = new THREE.Mesh(cGeo, carbonMat); c2.position.x = cOffset; scene.add(c2);
            const lc2 = createAtomLabel("C", "#60a5fa"); lc2.position.copy(c2.position); scene.add(lc2);

            // --- IKATAN C-C (Tunggal) ---
            // Orbital Model
            const sigmaGeo = new THREE.CylinderGeometry(0.15, 0.15, cOffset*2, 16);
            const sCC = new THREE.Mesh(sigmaGeo, sigmaMat); 
            sCC.rotation.z = Math.PI / 2; 
            scene.add(sCC); 
            sigmaBonds.push(sCC);

            // Stick Model
            const stickGeo = new THREE.CylinderGeometry(0.05, 0.05, cOffset*2, 12);
            const stCC = new THREE.Mesh(stickGeo, stickMat);
            stCC.rotation.z = Math.PI / 2;
            stCC.visible = false;
            scene.add(stCC);
            stickModel.push(stCC);

            // --- ATOM HIDROGEN ---
            // Kalkulasi posisi H untuk geometri tetrahedral (sp3)
            // Sudut 109.5 derajat
            // Kita gunakan trigonometri sederhana untuk konformasi Staggered
            
            const hDist = 1.1; // Jarak C-H
            // Sudut bukaan H terhadap sumbu X (sekitar 180 - 109.5 = 70.5 derajat dari sumbu ikatan)
            // cos(70.5) ~ 0.33, sin(70.5) ~ 0.94
            const hX_offset = 0.35; 
            const hR = 0.94 * hDist; // Radius lingkaran H pada bidang YZ

            // Definisi 3 sudut untuk H (0, 120, 240)
            const angles1 = [0, (2*Math.PI)/3, (4*Math.PI)/3];
            const angles2 = [Math.PI/3, Math.PI, (5*Math.PI)/3]; // Staggered (geser 60 derajat)

            // Fungsi Helper untuk membuat H dan Ikatan
            function addHydrogen(parentC_X, angle, isLeft) {
                const xDir = isLeft ? -1 : 1;
                const hX = parentC_X + (xDir * hX_offset * hDist); // Menjauh dari pusat
                const hY = Math.cos(angle) * hR;
                const hZ = Math.sin(angle) * hR;

                // Atom H
                const h = new THREE.Mesh(hGeo, hydrogenMat);
                h.position.set(hX, hY, hZ);
                scene.add(h);
                const lh = createAtomLabel("H", "#020617"); lh.position.copy(h.position); lh.scale.set(0.35,0.35,1); scene.add(lh);

                // Hitung posisi tengah dan rotasi untuk ikatan
                const midX = (parentC_X + hX) / 2;
                const midY = hY / 2;
                const midZ = hZ / 2;
                const bondLen = Math.sqrt(Math.pow(hX - parentC_X, 2) + Math.pow(hY, 2) + Math.pow(hZ, 2));

                // Orbital Bond (Sigma)
                const sGeo = new THREE.CylinderGeometry(0.08, 0.08, bondLen, 8);
                const sBond = new THREE.Mesh(sGeo, sigmaMat);
                sBond.position.set(midX, midY, midZ);
                sBond.lookAt(new THREE.Vector3(hX, hY, hZ));
                sBond.rotateX(Math.PI/2); // Cylinder default Y-up, need to reorient
                scene.add(sBond);
                sigmaBonds.push(sBond);

                // Stick Bond
                const stGeo = new THREE.CylinderGeometry(0.04, 0.04, bondLen, 8);
                const stBond = new THREE.Mesh(stGeo, stickMat);
                stBond.position.set(midX, midY, midZ);
                stBond.lookAt(new THREE.Vector3(hX, hY, hZ));
                stBond.rotateX(Math.PI/2);
                stBond.visible = false;
                scene.add(stBond);
                stickModel.push(stBond);
            }

            // Generate H untuk C1 (Kiri)
            angles1.forEach(ang => addHydrogen(-cOffset, ang, true));

            // Generate H untuk C2 (Kanan)
            angles2.forEach(ang => addHydrogen(cOffset, ang, false));
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            if (controls) controls.update();
            renderer.render(scene, camera);
        }

        window.onload = init;
    </script>
</body>
</html>